jQuery(function(a){"use strict";function b(){a(".field_pos").each(function(b,d){d=a(d);var e=a("#field"+d.attr("id")),f=a("#voucher_image_0");if(""===f.attr("src"))return void(e&&e.hide());var g=1;i!==f.width()&&(g=f.width()/i);var h=d.val()?d.val().split(",").map(function(a){return parseInt(a,10)*g}):null;if(0===e.length){var j=d.prev().find("label").html();j=j.substr(0,j.length-9),a("#voucher_image_wrapper").append('<span id="field'+d.attr("id")+'" class="voucher_field" style="display:none;">'+j+"</span>"),a("#field"+d.attr("id")).click(function(a){c(a.target.id.substr(6))}),e=a("#field"+d.attr("id"))}h?(e.css({left:h[0]+"px",top:h[1]+"px",width:h[2]+"px",height:h[3]+"px"}),e.show()):e.hide()})}function c(b){if(a("img#voucher_image_0").attr("src")){if(d(),a("#"+b).val()===woocommerce_vouchers_params.done_label)return void a("#"+b).val(woocommerce_vouchers_params.set_position_label);a("#field_"+b).hide();var c=a("#_"+b).val()?a("#_"+b).val().split(",").map(function(a){return parseInt(a,10)}):[null,null,null,null];a("input.set_position").val(woocommerce_vouchers_params.set_position_label),a("#"+b).val(woocommerce_vouchers_params.done_label),k=a("img#voucher_image_0").imgAreaSelect({show:!0,handles:!0,instance:!0,imageWidth:i,imageHeight:j,x1:c[0],y1:c[1],x2:c[0]+c[2],y2:c[1]+c[3],onSelectEnd:function(a,c){e(c,b)}}),a(document).scrollTop()>a("img#voucher_image_0").offset().top+a("img#voucher_image_0").height()*(2/3)&&a("html, body").animate({scrollTop:a("#woocommerce-voucher-image").offset().top},500)}}function d(){a("img#voucher_image_0").imgAreaSelect({remove:!0}),b()}function e(b,c){a("#_"+c).val(b.x1+","+b.y1+","+b.width+","+b.height),a("#remove_"+c).show()}function f(){a(".remove-alternative-voucher-image").click(function(){var b=a(this).parent(),c=b;return a("input",c).val(""),a("img",c).attr("src",""),b.hide(),!1})}a("button.redeem_all_vouchers").live("click",function(){a(".voucher_redeem").each(function(b,c){c=a(c);var d=new Date,e=String(d.getMonth()+1),f=String(d.getDate());1===e.length&&(e="0"+e),1===f.length&&(f="0"+f),d=d.getFullYear()+"-"+e+"-"+f,c.val()||c.val(d)})}),window.send_to_editor_default=window.send_to_editor;var g,h,i=woocommerce_vouchers_params.primary_image_width,j=woocommerce_vouchers_params.primary_image_height;a("#set-voucher-image, #set-additional-image, #add-alternative-voucher-image").live("click",function(b){return b.preventDefault(),h=a(this),g?void g.open():(g=wp.media.frames.file_frame=wp.media({title:"Select an Image",button:{text:"Set Image"},multiple:!1}),g.on("select",function(){var b=g.state().get("selection").first().toJSON();if(i=b.width,j=b.height,"set-voucher-image"===h.attr("id"))a("#upload_image_id_0").val(b.id),a("#remove-voucher-image").show(),a("img#voucher_image_0").attr("src",b.url);else if("set-additional-image"===h.attr("id"))a("#upload_additional_image_id_0").val(b.id),a("#set-additional-image").hide(),a("#remove-additional-image").show(),a("img#voucher_additional_image").attr("src",b.url);else if("add-alternative-voucher-image"===h.attr("id")){var c=a("#voucher_alternative_images li").size()+1;a("#voucher_alternative_images").append('<li class="alternative_image"><a href="#" class="remove-alternative-voucher-image"><img style="max-width:100px;max-height:100px;" src="'+b.url+'" /><input type="hidden" name="upload_image_id['+c+']" class="upload_image_id" value="'+b.id+'" /><span class="overlay"></span></a></li>'),f()}}),void g.open())}),a("#remove-voucher-image").click(function(){return a("#upload_image_id_0").val(""),a("img#voucher_image_0").attr("src",""),a(this).hide(),!1}),a(window).resize(function(){b()}),b();var k;a("input.set_position").click(function(){c(this.id)}),a("input.remove_position").click(function(){a(this).hide(),a("#_"+this.id.substr(7)).val(""),a("#"+this.id.substr(7)).val(woocommerce_vouchers_params.set_position_label),d()}),f(),a("#remove-additional-image").click(function(){return a("#upload_additional_image_id_0").val(""),a("img#voucher_additional_image").attr("src",""),a(this).hide(),a("#set-additional-image").show(),!1})});
